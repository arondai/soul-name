<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoulName: Your K-Name Destiny</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="생년월일시를 입력하고 사주에 맞는 최고의 한국 이름을 추천받으세요. 오행 분석을 통해 당신의 운명을 조화롭게 만들 이름을 찾아드립니다.">
    <meta name="keywords" content="작명, 이름짓기, 사주, 사주풀이, 한국 이름, 아기 이름, 개명, K-Name, Saju">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Nanum+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Nanum Gothic', sans-serif;
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3b82f6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .section-hidden {
            display: none;
            opacity: 0;
            transition: opacity 0.7s ease-in-out;
        }
        .section-visible {
            display: block;
            opacity: 1;
        }
        .hanja {
            font-size: 1.1em;
            font-weight: 600;
            color: #1e3a8a;
        }
        .dropdown-options {
            transition: opacity 0.2s ease-out, transform 0.2s ease-out;
        }
        @keyframes pulse-glow {
            0%, 100% {
                transform: scale(1);
                text-shadow: 0 0 5px rgba(59, 130, 246, 0.2);
            }
            50% {
                transform: scale(1.03);
                text-shadow: 0 0 15px rgba(59, 130, 246, 0.6);
            }
        }
        .pulsing-link {
            display: inline-block;
            animation: pulse-glow 2.5s infinite ease-in-out;
        }
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 24px;
            border: 1px solid #888;
            width: 90%;
            max-width: 500px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-900" data-lang="pageTitle">SoulName: Your K-Name Destiny</h1>
            <div class="relative" id="languageSelectorContainer">
                <button type="button" id="languageSelectorButton" class="inline-flex items-center justify-center w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    <span id="selectedLangFlag" class="mr-2">🇺🇸</span>
                    <span id="selectedLangText">EN</span>
                </button>
                <div id="languageOptions" class="hidden dropdown-options origin-top-right absolute right-0 mt-2 w-32 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-10">
                    <div class="py-1" role="none">
                        <a href="#" class="lang-option text-gray-700 flex items-center px-4 py-2 text-sm hover:bg-gray-100" data-lang="en"><span class="mr-2">🇺🇸</span><span>EN</span></a>
                        <a href="#" class="lang-option text-gray-700 flex items-center px-4 py-2 text-sm hover:bg-gray-100" data-lang="es"><span class="mr-2">🇪🇸</span><span>ES</span></a>
                        <a href="#" class="lang-option text-gray-700 flex items-center px-4 py-2 text-sm hover:bg-gray-100" data-lang="ko"><span class="mr-2">🇰🇷</span><span>KR</span></a>
                    </div>
                </div>
            </div>
        </header>

        <main>
            <section id="introSection" class="bg-white p-6 md:p-8 rounded-xl shadow-lg mb-8">
                <p class="text-lg text-center mb-6" data-lang="introText">Discover your personalized Korean name, crafted from the cosmic blueprint of your birth date and time.</p>
                <form id="sajuForm" novalidate>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label for="year" class="block text-sm font-medium text-gray-700" data-lang="yearLabel">Year</label>
                            <input type="number" id="year" placeholder="YYYY" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <p id="yearError" class="text-red-600 text-sm mt-1 h-5"></p>
                        </div>
                        <div>
                            <label for="month" class="block text-sm font-medium text-gray-700" data-lang="monthLabel">Month</label>
                            <select id="month" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"></select>
                            <p class="h-5"></p>
                        </div>
                        <div>
                            <label for="day" class="block text-sm font-medium text-gray-700" data-lang="dayLabel">Day</label>
                            <input type="number" id="day" placeholder="DD" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                             <p id="dayError" class="text-red-600 text-sm mt-1 h-5"></p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div><label for="hour" class="block text-sm font-medium text-gray-700" data-lang="hourLabel">Hour</label><select id="hour" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"></select></div>
                        <div><label for="minute" class="block text-sm font-medium text-gray-700" data-lang="minuteLabel">Minute</label><select id="minute" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"></select></div>
                        <div><label class="block text-sm font-medium text-gray-700" data-lang="genderLabel">Gender</label><div class="mt-2 flex items-center space-x-4"><label class="inline-flex items-center"><input type="radio" name="gender" value="male" class="form-radio text-blue-600" checked><span class="ml-2" data-lang="male">Male</span></label><label class="inline-flex items-center"><input type="radio" name="gender" value="female" class="form-radio text-pink-600"><span class="ml-2" data-lang="female">Female</span></label></div></div>
                    </div>
                    <button type="submit" id="submitButton" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg transition duration-300 ease-in-out transform hover:scale-105"><span data-lang="findNameButton">Find My K-Name</span></button>
                </form>
            </section>

            <div id="loader" class="hidden justify-center items-center my-8"><div class="loader"></div></div>

            <section id="resultsSection" class="section-hidden">
                <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
                    <h2 class="text-2xl md:text-3xl font-bold text-center mb-2" data-lang="resultTitle">Your Saju Profile & Name Recommendations</h2>
                    <p class="text-center text-gray-500 mb-8"><span data-lang="generatedFor">Generated for birth date</span>: <span id="birthDateDisplay" class="font-semibold"></span></p>
                    <div class="mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200"><h3 class="text-xl font-bold mb-4 text-gray-800" data-lang="sajuReadingTitle">1. Your Saju Analysis</h3><div id="sajuAnalysisReport" class="text-gray-700 leading-relaxed space-y-3"></div></div>
                    <div class="mb-8"><h3 class="text-xl font-bold mb-4 text-gray-800" data-lang="fiveElementsDistributionTitle">2. Five Elements Distribution</h3><div id="fiveElementsChart" class="grid grid-cols-5 gap-2 md:gap-4 items-end min-h-[160px] bg-gray-50 p-4 rounded-lg border border-gray-200"></div></div>
                    <div class="mb-8"><h3 class="text-xl font-bold mb-4 text-gray-800" data-lang="recommendedNamesTitle">3. Recommended Names to Harmonize Your Energy</h3><div id="recommendedNames" class="space-y-6"></div></div>
                    <div id="detailLinkContainer" class="mt-10 pt-6 border-t border-gray-200 text-center">
                        <a href="https://t.me/your_saju_expert" target="_blank" class="text-blue-600 hover:text-blue-800 underline font-semibold pulsing-link" data-lang="detailLink">For a more detailed Saju reading, please click here!</a>
                    </div>
                    <p id="timeInfo" class="mt-6 text-sm text-center text-gray-500" data-lang="timeInfo"></p>
                </div>
            </section>
        </main>
        
        <footer class="text-center text-gray-500 text-sm mt-12 space-y-2">
            <div class="space-x-4">
                <a href="#" id="privacyPolicyLink" class="hover:underline" data-lang="privacyPolicy">Privacy Policy</a>
                <span>|</span>
                <a href="#" id="termsOfServiceLink" class="hover:underline" data-lang="termsOfService">Terms of Service</a>
            </div>
            <p data-lang="entertainmentOnly">For entertainment purposes only. SoulName: Your K-Name Destiny &copy; 2024.</p>
        </footer>
    </div>

    <!-- Modals for Legal Information -->
    <div id="privacyModal" class="modal"><div class="modal-content"><h2 class="text-xl font-bold mb-4" data-lang="privacyPolicy">Privacy Policy</h2><p class="mb-4" data-lang="privacyText">We do not collect, store, or share any personal information you enter. All data, including your birth date and time, is processed only within your browser and is never sent to our servers. Your privacy is fully protected.</p><button id="closePrivacyModal" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700" data-lang="close">Close</button></div></div>
    <div id="termsModal" class="modal"><div class="modal-content"><h2 class="text-xl font-bold mb-4" data-lang="termsOfService">Terms of Service</h2><p class="mb-4" data-lang="termsText">This service is provided for entertainment purposes only. The analyses and name recommendations are based on simplified principles of Saju Myeongrihak and should not be taken as professional advice. By using this service, you agree that the developers are not liable for any decisions made based on the information provided.</p><button id="closeTermsModal" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700" data-lang="close">Close</button></div></div>

<script>
// ===================================================================================
// I. SAJU NAMER ENGINE - KNOWLEDGE BASE
// ===================================================================================
const HanjaInfo = [
    // --- Water Element (水) --- 30
    { hanja: '河', hangul: '하', jawon: 'water', meaning: { en: 'river', ko: '강', es: 'río' }, keywords: { en: ['flow', 'grand'], ko: ['흐름', '웅장함'], es: ['flujo', 'grandeza'] } },
    { hanja: '潤', hangul: '윤', jawon: 'water', meaning: { en: 'to enrich', ko: '윤택하다', es: 'enriquecer' }, keywords: { en: ['prosperity', 'softness'], ko: ['번영', '부드러움'], es: ['prosperidad', 'suavidad'] } },
    { hanja: '海', hangul: '해', jawon: 'water', meaning: { en: 'sea, ocean', ko: '바다', es: 'mar, océano' }, keywords: { en: ['vastness', 'potential'], ko: ['광활함', '잠재력'], es: ['inmensidad', 'potencial'] } },
    { hanja: '澤', hangul: '택', jawon: 'water', meaning: { en: 'marsh, benefit', ko: '못, 혜택', es: 'pantano, beneficio' }, keywords: { en: ['grace', 'abundance'], ko: ['은혜', '풍요'], es: ['gracia', 'abundancia'] } },
    { hanja: '泉', hangul: '천', jawon: 'water', meaning: { en: 'spring, fountain', ko: '샘', es: 'fuente, manantial' }, keywords: { en: ['freshness', 'origin'], ko: ['신선함', '근원'], es: ['frescura', 'origen'] } },
    { hanja: '浩', hangul: '호', jawon: 'water', meaning: { en: 'vast, great', ko: '넓다, 크다', es: 'vasto, grande' }, keywords: { en: ['generosity', 'power'], ko: ['관대함', '힘'], es: ['generosidad', 'poder'] } },
    { hanja: '源', hangul: '원', jawon: 'water', meaning: { en: 'source, origin', ko: '근원', es: 'fuente, origen' }, keywords: { en: ['beginning', 'wisdom'], ko: ['시작', '지혜'], es: ['comienzo', 'sabiduría'] } },
    { hanja: '洛', hangul: '락', jawon: 'water', meaning: { en: 'river name', ko: '강 이름', es: 'nombre de río' }, keywords: { en: ['clarity', 'capital'], ko: ['명료함', '수도'], es: ['claridad', 'capital'] } },
    { hanja: '泰', hangul: '태', jawon: 'water', meaning: { en: 'great, peaceful', ko: '크다, 평화롭다', es: 'grande, pacífico' }, keywords: { en: ['stability', 'calmness'], ko: ['안정', '평온'], es: ['estabilidad', 'calma'] } },
    { hanja: '淳', hangul: '순', jawon: 'water', meaning: { en: 'pure, genuine', ko: '순수하다', es: 'puro, genuino' }, keywords: { en: ['sincerity', 'kindness'], ko: ['진실함', '친절'], es: ['sinceridad', 'amabilidad'] } },
    { hanja: '淑', hangul: '숙', jawon: 'water', meaning: { en: 'pure, virtuous', ko: '맑다, 정숙하다', es: 'pura, virtuosa' }, keywords: { en: ['elegance', 'gentleness'], ko: ['우아함', '온화함'], es: ['elegancia', 'dulzura'] } },
    { hanja: '涵', hangul: '함', jawon: 'water', meaning: { en: 'to contain, soak', ko: '포함하다, 젖다', es: 'contener, empapar' }, keywords: { en: ['tolerance', 'depth'], ko: ['관용', '깊이'], es: ['tolerancia', 'profundidad'] } },
    { hanja: '淵', hangul: '연', jawon: 'water', meaning: { en: 'abyss, deep', ko: '못, 깊다', es: 'abismo, profundo' }, keywords: { en: ['wisdom', 'thoughtfulness'], ko: ['지혜', '사려깊음'], es: ['sabiduría', 'consideración'] } },
    { hanja: '淇', hangul: '기', jawon: 'water', meaning: { en: 'river in China', ko: '강 이름', es: 'río en China' }, keywords: { en: ['vitality', 'cleanliness'], ko: ['활력', '깨끗함'], es: ['vitalidad', 'limpieza'] } },
    { hanja: '洲', hangul: '주', jawon: 'water', meaning: { en: 'continent, island', ko: '대륙, 섬', es: 'continente, isla' }, keywords: { en: ['world', 'foundation'], ko: ['세계', '기반'], es: ['mundo', 'fundamento'] } },
    // --- Wood Element (木) --- 30
    { hanja: '林', hangul: '림', jawon: 'wood', meaning: { en: 'forest', ko: '숲', es: 'bosque' }, keywords: { en: ['growth', 'vitality'], ko: ['성장', '활력'], es: ['crecimiento', 'vitalidad'] } },
    { hanja: '秀', hangul: '수', jawon: 'wood', meaning: { en: 'outstanding', ko: '빼어나다', es: 'sobresaliente' }, keywords: { en: ['excellence', 'beauty'], ko: ['탁월함', '아름다움'], es: ['excelencia', 'belleza'] } },
    { hanja: '栽', hangul: '재', jawon: 'wood', meaning: { en: 'to plant', ko: '심다', es: 'plantar' }, keywords: { en: ['nurture', 'potential'], ko: ['양육', '잠재력'], es: ['nutrir', 'potencial'] } },
    { hanja: '彬', hangul: '빈', jawon: 'wood', meaning: { en: 'refined', ko: '빛나다', es: 'refinado' }, keywords: { en: ['culture', 'harmony'], ko: ['문화', '조화'], es: ['cultura', 'armonía'] } },
    { hanja: '根', hangul: '근', jawon: 'wood', meaning: { en: 'root', ko: '뿌리', es: 'raíz' }, keywords: { en: ['foundation', 'strength'], ko: ['기초', '힘'], es: ['fundamento', 'fuerza'] } },
    { hanja: '植', hangul: '식', jawon: 'wood', meaning: { en: 'to plant', ko: '세우다', es: 'establecer' }, keywords: { en: ['establish', 'growth'], ko: ['설립', '성장'], es: ['establecer', 'crecimiento'] } },
    { hanja: '材', hangul: '재', jawon: 'wood', meaning: { en: 'timber, talent', ko: '재목, 재능', es: 'madera, talento' }, keywords: { en: ['ability', 'resource'], ko: ['능력', '자원'], es: ['habilidad', 'recurso'] } },
    { hanja: '東', hangul: '동', jawon: 'wood', meaning: { en: 'east', ko: '동쪽', es: 'este' }, keywords: { en: ['beginning', 'hope'], ko: ['시작', '희망'], es: ['comienzo', 'esperanza'] } },
    { hanja: '采', hangul: '채', jawon: 'wood', meaning: { en: 'to gather, colorful', ko: '캐다, 채색', es: 'recoger, colorido' }, keywords: { en: ['art', 'variety'], ko: ['예술', '다채로움'], es: ['arte', 'variedad'] } },
    { hanja: '芝', hangul: '지', jawon: 'wood', meaning: { en: 'iris', ko: '지초', es: 'iris' }, keywords: { en: ['beauty', 'nobility'], ko: ['아름다움', '고귀함'], es: ['belleza', 'nobleza'] } },
    { hanja: '英', hangul: '영', jawon: 'wood', meaning: { en: 'flower, hero', ko: '꽃, 영웅', es: 'flor, héroe' }, keywords: { en: ['bravery', 'excellence'], ko: ['용기', '탁월함'], es: ['valentía', 'excelencia'] } },
    { hanja: '蘭', hangul: '란', jawon: 'wood', meaning: { en: 'orchid', ko: '난초', es: 'orquídea' }, keywords: { en: ['elegance', 'purity'], ko: ['우아함', '순수'], es: ['elegancia', 'pureza'] } },
    { hanja: '材', hangul: '채', jawon: 'wood', meaning: { en: 'talent', ko: '재능', es: 'talento' }, keywords: { en: ['skill', 'potential'], ko: ['기술', '잠재력'], es: ['habilidad', 'potencial'] } },
    { hanja: '橋', hangul: '교', jawon: 'wood', meaning: { en: 'bridge', ko: '다리', es: 'puente' }, keywords: { en: ['connection', 'mediation'], ko: ['연결', '중재'], es: ['conexión', 'mediación'] } },
    { hanja: '策', hangul: '책', jawon: 'wood', meaning: { en: 'plan, strategy', ko: '계책', es: 'plan, estrategia' }, keywords: { en: ['wisdom', 'planning'], ko: ['지혜', '계획'], es: ['sabiduría', 'planificación'] } },
    // --- Fire Element (火) --- 30
    { hanja: '煥', hangul: '환', jawon: 'fire', meaning: { en: 'shining', ko: '빛나다', es: 'brillante' }, keywords: { en: ['passion', 'brightness'], ko: ['열정', '밝음'], es: ['pasión', 'brillo'] } },
    { hanja: '映', hangul: '영', jawon: 'fire', meaning: { en: 'to reflect', ko: '비추다', es: 'reflejar' }, keywords: { en: ['light', 'influence'], ko: ['빛', '영향력'], es: ['luz', 'influencia'] } },
    { hanja: '旭', hangul: '욱', jawon: 'fire', meaning: { en: 'rising sun', ko: '아침 해', es: 'sol naciente' }, keywords: { en: ['hope', 'energy'], ko: ['희망', '에너지'], es: ['esperanza', 'energía'] } },
    { hanja: '夏', hangul: '하', jawon: 'fire', meaning: { en: 'summer', ko: '여름', es: 'verano' }, keywords: { en: ['vitality', 'activity'], ko: ['활력', '활동'], es: ['vitalidad', 'actividad'] } },
    { hanja: '光', hangul: '광', jawon: 'fire', meaning: { en: 'light, glory', ko: '빛, 영광', es: 'luz, gloria' }, keywords: { en: ['honor', 'brightness'], ko: ['명예', '밝음'], es: ['honor', 'brillo'] } },
    { hanja: '烈', hangul: '렬', jawon: 'fire', meaning: { en: 'ardent, fiery', ko: '맵다, 뜨겁다', es: 'ardiente, fogoso' }, keywords: { en: ['passion', 'strength'], ko: ['열정', '힘'], es: ['pasión', 'fuerza'] } },
    { hanja: '然', hangul: '연', jawon: 'fire', meaning: { en: 'to be so, yes', ko: '그러하다', es: 'ser así, sí' }, keywords: { en: ['nature', 'affirmation'], ko: ['자연', '긍정'], es: ['naturaleza', 'afirmación'] } },
    { hanja: '熹', hangul: '희', jawon: 'fire', meaning: { en: 'bright, warm', ko: '밝다, 따뜻하다', es: 'brillante, cálido' }, keywords: { en: ['kindness', 'hope'], ko: ['친절', '희망'], es: ['amabilidad', 'esperanza'] } },
    { hanja: '昶', hangul: '창', jawon: 'fire', meaning: { en: 'bright, long day', ko: '밝다, 해가 길다', es: 'brillante, día largo' }, keywords: { en: ['endurance', 'clarity'], ko: ['인내', '명확함'], es: ['resistencia', 'claridad'] } },
    { hanja: '燮', hangul: '섭', jawon: 'fire', meaning: { en: 'to blend, harmonize', ko: '화합하다', es: 'mezclar, armonizar' }, keywords: { en: ['cooperation', 'balance'], ko: ['협력', '균형'], es: ['cooperación', 'equilibrio'] } },
    { hanja: '燈', hangul: '등', jawon: 'fire', meaning: { en: 'lamp, light', ko: '등불', es: 'lámpara, luz' }, keywords: { en: ['guidance', 'wisdom'], ko: ['안내', '지혜'], es: ['guía', 'sabiduría'] } },
    { hanja: '炫', hangul: '현', jawon: 'fire', meaning: { en: 'to shine, glitter', ko: '빛나다, 자랑하다', es: 'brillar, relucir' }, keywords: { en: ['talent', 'expression'], ko: ['재능', '표현'], es: ['talento', 'expresión'] } },
    { hanja: '煇', hangul: '휘', jawon: 'fire', meaning: { en: 'brilliance', ko: '빛', es: 'brillo' }, keywords: { en: ['leadership', 'glory'], ko: ['리더십', '영광'], es: ['liderazgo', 'gloria'] } },
    { hanja: '炳', hangul: '병', jawon: 'fire', meaning: { en: 'bright, glorious', ko: '빛나다', es: 'brillante, glorioso' }, keywords: { en: ['achievement', 'fame'], ko: ['성취', '명성'], es: ['logro', 'fama'] } },
    { hanja: '暖', hangul: '난', jawon: 'fire', meaning: { en: 'warm', ko: '따뜻하다', es: 'cálido' }, keywords: { en: ['comfort', 'affection'], ko: ['편안함', '애정'], es: ['comodidad', 'afecto'] } },
    // --- Earth Element (土) --- 30
    { hanja: '均', hangul: '균', jawon: 'earth', meaning: { en: 'even, balanced', ko: '고르다', es: 'uniforme, equilibrado' }, keywords: { en: ['stability', 'fairness'], ko: ['안정성', '공정함'], es: ['estabilidad', 'justicia'] } },
    { hanja: '祐', hangul: '우', jawon: 'earth', meaning: { en: 'divine help', ko: '도움', es: 'ayuda divina' }, keywords: { en: ['protection', 'fortune'], ko: ['보호', '행운'], es: ['protección', 'fortuna'] } },
    { hanja: '信', hangul: '신', jawon: 'earth', meaning: { en: 'trust, faith', ko: '믿음', es: 'confianza, fe' }, keywords: { en: ['reliability', 'integrity'], ko: ['신뢰성', '성실'], es: ['fiabilidad', 'integridad'] } },
    { hanja: '坤', hangul: '곤', jawon: 'earth', meaning: { en: 'earth principle', ko: '땅', es: 'principio de la tierra' }, keywords: { en: ['nurturing', 'receptivity'], ko: ['양육', '수용성'], es: ['crianza', 'receptividad'] } },
    { hanja: '在', hangul: '재', jawon: 'earth', meaning: { en: 'to exist, in', ko: '있다', es: 'existir, en' }, keywords: { en: ['presence', 'foundation'], ko: ['존재', '기반'], es: ['presencia', 'fundamento'] } },
    { hanja: '圭', hangul: '규', jawon: 'earth', meaning: { en: 'jade tablet', ko: '규', es: 'tableta de jade' }, keywords: { en: ['standard', 'nobility'], ko: ['표준', '고귀함'], es: ['estándar', 'nobleza'] } },
    { hanja: '城', hangul: '성', jawon: 'earth', meaning: { en: 'castle, wall', ko: '성', es: 'castillo, muralla' }, keywords: { en: ['protection', 'sturdiness'], ko: ['보호', '견고함'], es: ['protección', 'robustez'] } },
    { hanja: '垠', hangul: '은', jawon: 'earth', meaning: { en: 'boundary, bank', ko: '언덕, 경계', es: 'límite, orilla' }, keywords: { en: ['stability', 'expanse'], ko: ['안정', '광활함'], es: ['estabilidad', 'extensión'] } },
    { hanja: '基', hangul: '기', jawon: 'earth', meaning: { en: 'foundation, base', ko: '기초, 터', es: 'fundamento, base' }, keywords: { en: ['principle', 'potential'], ko: ['원칙', '잠재력'], es: ['principio', 'potencial'] } },
    { hanja: '培', hangul: '배', jawon: 'earth', meaning: { en: 'to cultivate', ko: '북돋우다', es: 'cultivar' }, keywords: { en: ['nurture', 'growth'], ko: ['양육', '성장'], es: ['nutrir', 'crecimiento'] } },
    { hanja: '庸', hangul: '용', jawon: 'earth', meaning: { en: 'common, to use', ko: '쓰다, 평범하다', es: 'común, usar' }, keywords: { en: ['harmony', 'steadiness'], ko: ['조화', '꾸준함'], es: ['armonía', 'constancia'] } },
    { hanja: '垣', hangul: '원', jawon: 'earth', meaning: { en: 'wall, fence', ko: '담', es: 'muro, valla' }, keywords: { en: ['support', 'protection'], ko: ['지원', '보호'], es: ['apoyo', 'protección'] } },
    { hanja: '譽', hangul: '예', jawon: 'earth', meaning: { en: 'fame, reputation', ko: '명예', es: 'fama, reputación' }, keywords: { en: ['honor', 'respect'], ko: ['명예', '존경'], es: ['honor', 'respeto'] } },
    { hanja: '陞', hangul: '승', jawon: 'earth', meaning: { en: 'to rise, advance', ko: '오르다', es: 'ascender, avanzar' }, keywords: { en: ['promotion', 'success'], ko: ['승진', '성공'], es: ['ascenso', 'éxito'] } },
    { hanja: '亞', hangul: '아', jawon: 'earth', meaning: { en: 'second, Asia', ko: '버금, 아시아', es: 'segundo, Asia' }, keywords: { en: ['center', 'foundation'], ko: ['중심', '기반'], es: ['centro', 'fundamento'] } },
    // --- Metal Element (金) --- 30
    { hanja: '瑞', hangul: '서', jawon: 'metal', meaning: { en: 'auspicious', ko: '상서롭다', es: 'auspicioso' }, keywords: { en: ['blessing', 'precious'], ko: ['축복', '귀중함'], es: ['bendición', 'precioso'] } },
    { hanja: '峻', hangul: '준', jawon: 'metal', meaning: { en: 'high mountain', ko: '높은 산', es: 'montaña alta' }, keywords: { en: ['strength', 'principle'], ko: ['강인함', '원칙'], es: ['fuerza', 'principio'] } },
    { hanja: '錫', hangul: '석', jawon: 'metal', meaning: { en: 'to bestow, tin', ko: '주석, 하사하다', es: 'otorgar, estaño' }, keywords: { en: ['granting', 'value'], ko: ['수여', '가치'], es: ['concesión', 'valor'] } },
    { hanja: '玲', hangul: '령', jawon: 'metal', meaning: { en: 'sound of jade', ko: '옥 소리', es: 'sonido de jade' }, keywords: { en: ['clarity', 'bright'], ko: ['명료함', '밝음'], es: ['claridad', 'brillante'] } },
    { hanja: '鈴', hangul: '령', jawon: 'metal', meaning: { en: 'bell', ko: '방울', es: 'campana' }, keywords: { en: ['alertness', 'sound'], ko: ['기민함', '소리'], es: ['alerta', 'sonido'] } },
    { hanja: '鈺', hangul: '옥', jawon: 'metal', meaning: { en: 'treasure', ko: '보물', es: 'tesoro' }, keywords: { en: ['precious', 'hardness'], ko: ['귀중함', '견고함'], es: ['precioso', 'dureza'] } },
    { hanja: '錚', hangul: '쟁', jawon: 'metal', meaning: { en: 'sound of metal', ko: '쇳소리', es: 'sonido de metal' }, keywords: { en: ['excellent', 'sharp'], ko: ['뛰어남', '날카로움'], es: ['excelente', 'agudo'] } },
    { hanja: '鎭', hangul: '진', jawon: 'metal', meaning: { en: 'to guard', ko: '진압하다', es: 'guardar' }, keywords: { en: ['stability', 'leadership'], ko: ['안정', '리더십'], es: ['estabilidad', 'liderazgo'] } },
    { hanja: '鉉', hangul: '현', jawon: 'metal', meaning: { en: 'tripod lug, wise', ko: '솥귀, 지혜', es: 'asa de trípode, sabio' }, keywords: { en: ['wisdom', 'support'], ko: ['지혜', '지지'], es: ['sabiduría', 'apoyo'] } },
    { hanja: '銀', hangul: '은', jawon: 'metal', meaning: { en: 'silver', ko: '은', es: 'plata' }, keywords: { en: ['value', 'purity'], ko: ['가치', '순수'], es: ['valor', 'pureza'] } },
    { hanja: '鍾', hangul: '종', jawon: 'metal', meaning: { en: 'bell, cup', ko: '쇠북, 잔', es: 'campana, copa' }, keywords: { en: ['gathering', 'center'], ko: ['모임', '중심'], es: ['reunión', 'centro'] } },
    { hanja: '鍊', hangul: '련', jawon: 'metal', meaning: { en: 'to refine, train', ko: '단련하다', es: 'refinar, entrenar' }, keywords: { en: ['discipline', 'perfection'], ko: ['단련', '완벽'], es: ['disciplina', 'perfección'] } },
    { hanja: '宰', hangul: '재', jawon: 'metal', meaning: { en: 'to rule', ko: '재상', es: 'gobernar' }, keywords: { en: ['leadership', 'judgment'], ko: ['리더십', '판단력'], es: ['liderazgo', 'juicio'] } },
    { hanja: '剛', hangul: '강', jawon: 'metal', meaning: { en: 'strong, firm', ko: '굳세다', es: 'fuerte, firme' }, keywords: { en: ['courage', 'integrity'], ko: ['용기', '청렴'], es: ['coraje', 'integridad'] } },
    { hanja: '創', hangul: '창', jawon: 'metal', meaning: { en: 'to create, begin', ko: '비롯하다, 만들다', es: 'crear, comenzar' }, keywords: { en: ['innovation', 'initiative'], ko: ['혁신', '진취'], es: ['innovación', 'iniciativa'] } }
].map(h => ({...h, good: true, strokes: h.strokes || 10 }));


const translations = {
    en: {
        pageTitle: "SoulName: Your K-Name Destiny", introText: "Discover your personalized Korean name, crafted from the cosmic blueprint of your birth date and time.", findNameButton: "Find My K-Name", resultTitle: "Your Saju Profile & Name Recommendations", generatedFor: "Generated for", sajuReadingTitle: "1. Your Saju Analysis", fiveElementsDistributionTitle: "2. Five Elements Distribution", recommendedNamesTitle: "3. Recommended Names to Harmonize Your Energy", recommendation: "Recommendation", timeInfo: "For a more precise analysis, knowing the exact time of birth is recommended.", unknownTime: "Unknown", yearLabel: "Year", monthLabel: "Month", dayLabel: "Day", hourLabel: "Hour", minuteLabel: "Minute", genderLabel: "Gender", male: "Male", female: "Female",
        privacyPolicy: "Privacy Policy", termsOfService: "Terms of Service", close: "Close", entertainmentOnly: "For entertainment purposes only. SoulName: Your K-Name Destiny © 2024.",
        privacyText: "We do not collect, store, or share any personal information you enter. All data, including your birth date and time, is processed only within your browser and is never sent to our servers. Your privacy is fully protected.",
        termsText: "This service is provided for entertainment purposes only. The analyses and name recommendations are based on simplified principles of Saju Myeongrihak and should not be taken as professional advice. By using this service, you agree that the developers are not liable for any decisions made based on the information provided.",
        detailLink: "Already have a name? See how well it harmonizes with your Saju!",
        yearError: "Please enter a year between 1940-2040.",
        dayError: "Please enter a valid day.",
        elements: { wood: 'Wood', fire: 'Fire', earth: 'Earth', metal: 'Metal', water: 'Water' },
        strengths: { strong: 'strong', weak: 'weak' },
        sajuAnalysis: {
            dayMasterIntro: (d, e) => `Your Saju's core identity, the "Day Master," is <strong>${d} (${e})</strong>.`,
            dayMasterDesc: {
                '甲': "This represents a tall, sturdy Tree, giving you natural leadership qualities, a progressive spirit, and a desire to grow and achieve.",
                '乙': "This embodies a flexible Flower or Vine, indicating adaptability, strong vitality, and a charming, sociable nature.",
                '丙': "You are like the brilliant Sun, full of passion, generosity, and a bright energy that illuminates everything around you.",
                '丁': "This is the warm, gentle light of a Candle or the Stars, suggesting a refined, sensitive nature with deep insight and warmth.",
                '戊': "You represent a vast, immovable Mountain, making you trustworthy, stable, and a central figure who can support others.",
                '己': "This is fertile, nurturing Earth, indicating a gentle, receptive, and cautious personality that can cultivate great things.",
                '庚': "You embody strong, unrefined Metal or a powerful Sword, giving you a decisive, loyal, and principled nature with a sharp mind.",
                '辛': "You are like a precious, polished Gem, suggesting a sophisticated, aesthetically-minded, and perfectionistic personality.",
                '壬': "This represents a great Ocean or River, indicating a wise, flexible, and all-embracing nature with great potential.",
                '癸': "This is the gentle Rain or Dew, suggesting an intelligent, creative, and sensitive personality with a talent for nurturing ideas."
            },
            sajuBalance: (s, b) => `Analysis shows your Day Master is <strong>${s}</strong>... your Saju benefits from <strong>${b.join(' and ')}</strong>.`,
            nameIntro: (n) => `We recommend <strong>${n.roman} (${n.hangul}, <span class="hanja">${n.hanja}</span>)</strong>. Here’s why:`,
            firstHanja: (h, e) => `The character <span class="hanja">${h.hanja}</span> means '<strong>${h.meaning.en}</strong>'. Its essence is <strong>${e}</strong>...`,
            secondHanja: (h, e) => `The character <span class="hanja">${h.hanja}</span> signifies '<strong>${h.meaning.en}</strong>'. It resonates with <strong>${e}</strong> energy...`,
            together: (n, h1, h2) => `Together, <strong>${n.roman}</strong> creates "<em>${h1.keywords.en[0]} and ${h2.keywords.en[1]}</em>"...`
        }
    },
    ko: {
        pageTitle: "소울네임: 당신의 운명을 담은 이름", introText: "생년월일시에 담긴 당신의 우주적 청사진으로 만드는, 당신만을 위한 한국 이름을 찾아보세요.", findNameButton: "내 이름 찾기", resultTitle: "사주 분석 및 이름 추천", generatedFor: "생년월일", sajuReadingTitle: "1. 사주 분석", fiveElementsDistributionTitle: "2. 오행 분포", recommendedNamesTitle: "3. 운명을 조화롭게 할 추천 이름", recommendation: "추천", timeInfo: "정확한 출생 시간을 입력하면 더 정밀한 분석이 가능합니다.", unknownTime: "모름", yearLabel: "연도", monthLabel: "월", dayLabel: "일", hourLabel: "시", minuteLabel: "분", genderLabel: "성별", male: "남성", female: "여성",
        privacyPolicy: "개인정보처리방침", termsOfService: "서비스 이용약관", close: "닫기", entertainmentOnly: "오락 목적으로만 제공됩니다. SoulName: Your K-Name Destiny © 2024.",
        privacyText: "당사가 수집, 저장 또는 공유하는 개인 정보는 없습니다. 생년월일을 포함한 모든 데이터는 브라우저 내에서만 처리되며 서버로 전송되지 않습니다. 개인 정보는 완벽하게 보호됩니다.",
        termsText: "본 서비스는 오락 목적으로만 제공됩니다. 분석 및 이름 추천은 사주명리학의 단순화된 원칙에 근거하므로 전문적인 조언으로 간주되어서는 안 됩니다. 본 서비스를 사용함으로써 귀하는 제공된 정보를 기반으로 한 모든 결정에 대해 개발자가 책임을 지지 않는다는 데 동의하는 것입니다.",
        detailLink: "지금 만든 이름과 사주의 조화가 궁금하다면 클릭!",
        yearError: "1940-2040년 사이의 연도를 입력해주세요.",
        dayError: "유효한 날짜를 입력해주세요.",
        elements: { wood: '목(木)', fire: '화(火)', earth: '토(土)', metal: '금(金)', water: '수(水)' },
        strengths: { strong: '강한', weak: '약한' },
        sajuAnalysis: {
            dayMasterIntro: (d, e) => `당신의 "일간(日干)"은 <strong>${d} (${e})</strong> 입니다.`,
            dayMasterDesc: {
                '甲': '크고 튼튼한 나무를 상징하며, 타고난 리더십과 진취적인 정신, 성장과 성취에 대한 열망을 의미합니다.',
                '乙': '유연한 꽃이나 덩굴을 상징하며, 뛰어난 적응력과 강한 생명력, 매력적이고 사교적인 성향을 나타냅니다.',
                '丙': '빛나는 태양과 같아, 열정과 관대함, 그리고 주변 모든 것을 비추는 밝은 에너지를 지녔습니다.',
                '丁': '따뜻하고 은은한 촛불이나 별빛으로, 깊은 통찰력과 온기를 지닌 섬세하고 감성적인 본성을 암시합니다.',
                '戊': '크고 움직이지 않는 산을 상징하여, 신뢰할 수 있고 안정적이며 다른 사람들을 지지할 수 있는 중심적인 인물임을 의미합니다.',
                '己': '만물을 키우는 비옥한 땅으로, 위대한 것을 일굴 수 있는 부드럽고 수용적이며 신중한 성격을 나타냅니다.',
                '庚': '강하고 제련되지 않은 금속이나 강력한 칼을 상징하며, 결단력 있고 의리 있으며 날카로운 정신을 가진 본성을 의미합니다.',
                '辛': '귀하고 잘 닦인 보석과 같아, 세련되고 미적 감각이 뛰어나며 완벽주의적인 성향을 암시합니다.',
                '壬': '거대한 바다나 강을 상징하며, 위대한 잠재력을 지닌 지혜롭고 유연하며 모든 것을 포용하는 본성을 나타냅니다.',
                '癸': '부드러운 비나 이슬을 상징하며, 지적이고 창의적이며 아이디어를 키우는 재능을 가진 섬세한 성격을 암시합니다.'
            },
            sajuBalance: (s, b) => `당신의 일간은 <strong>${s}</strong> 경향을 보입니다... <strong>${b.join('과 ')}</strong>의 기운이 가장 유용합니다.`,
            nameIntro: (n) => `<strong>${n.hangul} (<span class="hanja">${n.hanja}</span>, ${n.roman})</strong>을 추천합니다. 이유는 다음과 같습니다:`,
            firstHanja: (h, e) => `<span class="hanja">${h.hanja}</span>('${h.hangul}')은 '<strong>${h.meaning.ko}</strong>'을 의미하며 자원오행은 <strong>${e}</strong>으로...`,
            secondHanja: (h, e) => `<span class="hanja">${h.hanja}</span>('${h.hangul}')은 '<strong>${h.meaning.ko}</strong>'을 의미하며 <strong>${e}</strong>의 기운과 공명합니다...`,
            together: (n, h1, h2) => `<strong>'${n.hangul}'</strong>은 "<em>${h1.keywords.ko[0]}과 ${h2.keywords.ko[1]}</em>"이라는 이미지를 만듭니다...`
        }
    },
    es: {
        pageTitle: "SoulName: Tu Nombre Coreano del Destino", introText: "Descubre tu nombre coreano personalizado, creado a partir del plan cósmico de tu fecha y hora de nacimiento.", findNameButton: "Encontrar mi Nombre Coreano", resultTitle: "Tu Perfil Saju y Nombres Recomendados", generatedFor: "Generado para", sajuReadingTitle: "1. Tu Análisis Saju", fiveElementsDistributionTitle: "2. Distribución de los Cinco Elementos", recommendedNamesTitle: "3. Nombres Recomendados para Armonizar tu Energía", recommendation: "Recomendación", timeInfo: "Para un análisis más preciso, se recomienda saber la hora exacta de nacimiento.", unknownTime: "No sé", yearLabel: "Año", monthLabel: "Mes", dayLabel: "Día", hourLabel: "Hora", minuteLabel: "Minuto", genderLabel: "Género", male: "Masculino", female: "Femenino",
        privacyPolicy: "Política de Privacidad", termsOfService: "Términos de Servicio", close: "Cerrar", entertainmentOnly: "Solo para fines de entretenimiento. SoulName: Tu Nombre Coreano del Destino © 2024.",
        privacyText: "No recopilamos, almacenamos ni compartimos ninguna información personal que ingrese. Todos los datos, incluida su fecha y hora de nacimiento, se procesan solo dentro de su navegador y nunca se envían a nuestros servidores. Su privacidad está totalmente protegida.",
        termsText: "Este servicio se proporciona únicamente con fines de entretenimiento. Los análisis y las recomendaciones de nombres se basan en principios simplificados de Saju Myeongrihak y no deben tomarse como un consejo profesional. Al utilizar este servicio, usted acepta que los desarrolladores no son responsables de ninguna decisión tomada en base a la información proporcionada.",
        detailLink: "¿Ya tienes un nombre? ¡Descubre qué tan bien armoniza con tu Saju!",
        yearError: "Por favor, ingrese un año entre 1940-2040.",
        dayError: "Por favor, ingrese un día válido.",
        elements: { wood: 'Madera', fire: 'Fuego', earth: 'Tierra', metal: 'Metal', water: 'Agua' },
        strengths: { strong: 'fuerte', weak: 'débil' },
        sajuAnalysis: {
            dayMasterIntro: (d, e) => `Tu "Maestro del Día", es <strong>${d} (${e})</strong>.`,
            dayMasterDesc: {
                '甲': "Representa un Árbol alto y robusto, dándote cualidades de liderazgo natural, un espíritu progresista y un deseo de crecer y alcanzar metas.",
                '乙': "Encarna una Flor o Enredadera flexible, lo que indica adaptabilidad, gran vitalidad y una naturaleza encantadora y sociable.",
                '丙': "Eres como el Sol brillante, lleno de pasión, generosidad y una energía radiante que ilumina todo a tu alrededor.",
                '丁': "Es la luz cálida y suave de una Vela o las Estrellas, sugiriendo una naturaleza refinada y sensible con una profunda perspicacia y calidez.",
                '戊': "Representas una Montaña vasta e inamovible, lo que te hace digno de confianza, estable y una figura central que puede apoyar a otros.",
                '己': "Es la Tierra fértil y nutritiva, lo que indica una personalidad amable, receptiva y cautelosa que puede cultivar grandes cosas.",
                '庚': "Encarnas un Metal fuerte y sin refinar o una Espada poderosa, lo que te da una naturaleza decidida, leal y de principios con una mente aguda.",
                '辛': "Eres como una Gema preciosa y pulida, lo que sugiere una personalidad sofisticada, con mentalidad estética y perfeccionista.",
                '壬': "Representa un gran Océano o Río, lo que indica una naturaleza sabia, flexible y que todo lo abarca con un gran potencial.",
                '癸': "Es la Lluvia o el Rocío suave, lo que sugiere una personalidad inteligente, creativa y sensible con talento para nutrir ideas."
            },
            sajuBalance: (s, b) => `Tu Maestro del Día es <strong>${s}</strong>... tu Saju se beneficia de <strong>${b.join(' y ')}</strong>.`,
            nameIntro: (n) => `Recomendamos <strong>${n.roman} (${n.hangul}, <span class="hanja">${n.hanja}</span>)</strong>. He aquí por qué:`,
            firstHanja: (h, e) => `El carácter <span class="hanja">${h.hanja}</span> significa '<strong>${h.meaning.es}</strong>'. Su esencia es <strong>${e}</strong>...`,
            secondHanja: (h, e) => `El carácter <span class="hanja">${h.hanja}</span> significa '<strong>${h.meaning.es}</strong>'. Resuena con la energía de <strong>${e}</strong>...`,
            together: (n, h1, h2) => `Juntos, <strong>${n.roman}</strong> crea la imagen de "<em>${h1.keywords.es[0]} y ${h2.keywords.es[1]}</em>"...`
        }
    }
};

// ===================================================================================
// II. SAJU NAMER ENGINE - CORE LOGIC
// ===================================================================================

class SajuNamer {
    constructor() {
        this.Stems = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
        this.Branches = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
        this.Ganji = [];
        for (let i = 0; i < 60; i++) { this.Ganji.push(this.Stems[i % 10] + this.Branches[i % 12]); }
        this.ElementMap = { '甲':'wood', '乙':'wood', '寅':'wood', '卯':'wood', '丙':'fire', '丁':'fire', '巳':'fire', '午':'fire', '戊':'earth', '己':'earth', '丑':'earth', '辰':'earth', '未':'earth', '戌':'earth', '庚':'metal', '辛':'metal', '申':'metal', '酉':'metal', '壬':'water', '癸':'water', '子':'water', '亥':'water' };
        this.MonthBranches = ['寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥', '子', '丑'];
    }
    
    _countElements(saju) {
        const counts = { wood: 0, fire: 0, earth: 0, metal: 0, water: 0 };
        const sajuString = saju.year + saju.month + saju.day + (saju.hour || '');
        for (const char of sajuString) { const element = this.ElementMap[char]; if (element) { counts[element]++; } }
        return counts;
    }

    analyze(year, month, day, hour) {
        const saju = this._calculateSaju(year, month, day, hour);
        const elementCounts = this._countElements(saju);
        const dayMasterChar = saju.day[0];
        const dayMasterElement = this.ElementMap[dayMasterChar];
        const monthBranchElement = this.ElementMap[saju.month[1]];
        const strengtheningElements = { wood: ['water', 'wood'], fire: ['wood', 'fire'], earth: ['fire', 'earth'], metal: ['earth', 'metal'], water: ['metal', 'water'] };
        const isStrong = strengtheningElements[dayMasterElement].includes(monthBranchElement);
        const strength = isStrong ? 'strong' : 'weak';
        let beneficialElements = [];
        const fiveElementsCycle = ['wood', 'fire', 'earth', 'metal', 'water'];
        const dayMasterIndex = fiveElementsCycle.indexOf(dayMasterElement);
        if (isStrong) { beneficialElements.push(fiveElementsCycle[(dayMasterIndex + 1) % 5]); beneficialElements.push(fiveElementsCycle[(dayMasterIndex + 3) % 5]); } else { beneficialElements.push(fiveElementsCycle[(dayMasterIndex + 4) % 5]); beneficialElements.push(dayMasterElement); }
        return { saju, dayMasterChar, dayMasterElement, strength, beneficialElements, elementCounts };
    }

    generateNames(analysisResult, count = 2) {
        const { beneficialElements } = analysisResult;
        const recommendedNames = [];
        let usedHanjaPairs = new Set();
        for (let i = 0; i < count; i++) {
            const primaryElement = beneficialElements[i % beneficialElements.length];
            const firstHanjaPool = HanjaInfo.filter(h => h.jawon === primaryElement && h.good);
            if (firstHanjaPool.length === 0) continue;
            for(let j=0; j<10; j++) {
                const firstHanja = firstHanjaPool[Math.floor(Math.random() * firstHanjaPool.length)];
                const secondElement = beneficialElements[(i + 1) % beneficialElements.length];
                const secondHanjaPool = HanjaInfo.filter(h => (h.jawon === primaryElement || h.jawon === secondElement) && h.good && h.hanja !== firstHanja.hanja);
                if (secondHanjaPool.length === 0) continue;
                const secondHanja = secondHanjaPool[Math.floor(Math.random() * secondHanjaPool.length)];
                const pairKey = [firstHanja.hanja, secondHanja.hanja].sort().join('');
                if (!usedHanjaPairs.has(pairKey)) {
                     recommendedNames.push({ hangul: firstHanja.hangul + secondHanja.hangul, hanja: firstHanja.hanja + secondHanja.hanja, roman: this._romanize(firstHanja.hangul) + '-' + this._romanize(secondHanja.hangul), components: [firstHanja, secondHanja] });
                     usedHanjaPairs.add(pairKey);
                     break;
                }
            }
        }
        return recommendedNames;
    }

    generateExplanation(analysisResult, recommendedName, lang = 'en') {
        const { dayMasterChar, dayMasterElement, strength, beneficialElements } = analysisResult;
        const [h1, h2] = recommendedName.components;
        const trans = translations[lang] || translations['en'];
        const t = trans.sajuAnalysis;
        const elToString = (el) => trans.elements[el];
        const strengthToString = (str) => trans.strengths[str];
        const analysisSummary = `<p>${t.dayMasterIntro(dayMasterChar, elToString(dayMasterElement))}</p><p>${t.dayMasterDesc[dayMasterChar]}</p><p>${t.sajuBalance(strengthToString(strength), beneficialElements.map(elToString))}</p>`;
        const nameExplanation = `<p class="mb-2">${t.nameIntro(recommendedName)}</p><ul class="list-disc list-inside space-y-2 pl-2"><li>${t.firstHanja(h1, elToString(h1.jawon))}</li><li>${t.secondHanja(h2, elToString(h2.jawon))}</li></ul><p class="mt-3">${t.together(recommendedName, h1, h2)}</p>`;
        return { analysisSummary, nameExplanation };
    }

    _calculateSaju(year, month, day, hour) {
        const yearGanji = this.Ganji[(year - 1924 + 60) % 60];
        const solarMonthIndex = (month + 10) % 12;
        const monthBranch = this.MonthBranches[solarMonthIndex];
        const yearStem = yearGanji[0];
        const HourStems = { '甲':'甲', '乙':'丙', '丙':'戊', '丁':'庚', '戊':'壬', '己':'甲', '庚':'丙', '辛':'戊', '壬':'庚', '癸':'壬' };
        let monthStemIndex = this.Stems.indexOf(HourStems[yearStem[0]]);
        monthStemIndex = (monthStemIndex + solarMonthIndex) % 10;
        const monthGanji = this.Stems[monthStemIndex] + monthBranch;
        const epoch = new Date(1940, 0, 1);
        const targetDate = new Date(year, month - 1, day);
        const diffDays = Math.floor((targetDate - epoch) / (1000 * 60 * 60 * 24));
        const dayGanji = this.Ganji[(55 + diffDays) % 60];
        let hourGanji = null;
        if (hour !== -1) { const hourBranchIndex = Math.floor((hour + 1) / 2) % 12; const hourBranch = this.Branches[hourBranchIndex]; let hourStemIndex = this.Stems.indexOf(HourStems[dayGanji[0]]); hourStemIndex = (hourStemIndex + hourBranchIndex) % 10; hourGanji = this.Stems[hourStemIndex] + hourBranch; }
        return { year: yearGanji, month: monthGanji, day: dayGanji, hour: hourGanji };
    }

    _romanize(hangul) {
        const initial = {'ㄱ':'g','ㄲ':'kk','ㄴ':'n','ㄷ':'d','ㄸ':'tt','ㄹ':'r','ㅁ':'m','ㅂ':'b','ㅃ':'pp','ㅅ':'s','ㅆ':'ss','ㅇ':'','ㅈ':'j','ㅉ':'jj','ㅊ':'ch','ㅋ':'k','ㅌ':'t','ㅍ':'p','ㅎ':'h'}, medial = {'ㅏ':'a','ㅐ':'ae','ㅑ':'ya','ㅒ':'yae','ㅓ':'eo','ㅔ':'e','ㅕ':'yeo','ㅖ':'ye','ㅗ':'o','ㅘ':'wa','ㅙ':'wae','ㅚ':'oe','ㅛ':'yo','ㅜ':'u','ㅝ':'wo','ㅞ':'we','ㅟ':'wi','ㅠ':'yu','ㅡ':'eu','ㅢ':'ui','ㅣ':'i'}, final = {'':'','ㄱ':'k','ㄲ':'kk','ㄳ':'ks','ㄴ':'n','ㄵ':'nj','ㄶ':'nh','ㄷ':'t','ㄹ':'l','ㄺ':'lk','ㄻ':'lm','ㄼ':'lb','ㄽ':'ls','ㄾ':'lt','ㄿ':'lp','ㅀ':'lh','ㅁ':'m','ㅂ':'p','ㅄ':'ps','ㅅ':'t','ㅆ':'ss','ㅇ':'ng','ㅈ':'t','ㅊ':'t','ㅋ':'k','ㅌ':'t','ㅍ':'p','ㅎ':'h'}, ga = 44032; let r = '';
        for (let i = 0; i < hangul.length; i++) { const c = hangul.charCodeAt(i) - ga; if (c < 0 || c > 11171) continue; const iC=Math.floor(c/588), mC=Math.floor((c-(iC*588))/28), fC=c%28; r+=initial[Object.keys(initial)[iC]]; r+=medial[Object.keys(medial)[mC]]; r+=final[Object.keys(final)[fC]]; }
        return (r.charAt(0).toUpperCase() + r.slice(1));
    }
}

// ===================================================================================
// III. WEB APPLICATION LOGIC (UI & Event Handling)
// ===================================================================================

document.addEventListener('DOMContentLoaded', () => {
    const sajuNamer = new SajuNamer();
    const form = document.getElementById('sajuForm');
    
    const langContainer = document.getElementById('languageSelectorContainer');
    const langButton = document.getElementById('languageSelectorButton');
    const langOptions = document.getElementById('languageOptions');
    const selectedLangFlag = document.getElementById('selectedLangFlag');
    const selectedLangText = document.getElementById('selectedLangText');
    let currentLang = 'en';

    const langMap = { ko: { flag: '🇰🇷', text: 'KR' }, en: { flag: '🇺🇸', text: 'EN' }, es: { flag: '🇪🇸', text: 'ES' } };

    langButton.addEventListener('click', () => {
        langOptions.classList.toggle('hidden');
    });

    document.querySelectorAll('.lang-option').forEach(option => {
        option.addEventListener('click', (e) => {
            e.preventDefault();
            const newLang = e.currentTarget.dataset.lang;
            if (newLang !== currentLang) {
                currentLang = newLang;
                setLanguage(currentLang);
                if (document.getElementById('resultsSection').classList.contains('section-visible')) {
                    document.getElementById('submitButton').click();
                }
            }
            langOptions.classList.add('hidden');
        });
    });

    document.addEventListener('click', (e) => {
        if (!langContainer.contains(e.target)) {
            langOptions.classList.add('hidden');
        }
    });
    
    function initializeUI() {
        const monthSelect = document.getElementById('month');
        const hourSelect = document.getElementById('hour');
        const minuteSelect = document.getElementById('minute');
        for (let i = 1; i <= 12; i++) { monthSelect.add(new Option(`${i}`.padStart(2, '0'), i)); }
        hourSelect.add(new Option("Unknown", -1));
        for (let i = 0; i <= 23; i++) { hourSelect.add(new Option(`${i}`.padStart(2, '0'), i)); }
        for (let i = 0; i <= 59; i++) { minuteSelect.add(new Option(`${i}`.padStart(2, '0'), i)); }
        setLanguage(currentLang);
    }
    
    function validateInputs() {
        let isValid = true;
        const yearInput = document.getElementById('year');
        const dayInput = document.getElementById('day');
        
        const yearError = document.getElementById('yearError');
        const dayError = document.getElementById('dayError');
        
        const year = parseInt(yearInput.value);
        const day = parseInt(dayInput.value);
        
        const trans = translations[currentLang];

        // Reset errors
        [yearInput, dayInput].forEach(input => input.classList.remove('border-red-500'));
        [yearError, dayError].forEach(err => err.textContent = '');

        // Validate Year
        if (isNaN(year) || year < 1940 || year > 2040) {
            yearInput.classList.add('border-red-500');
            yearError.textContent = trans.yearError;
            isValid = false;
        }

        // Validate Day
        if (isNaN(day) || day < 1 || day > 31) {
            dayInput.classList.add('border-red-500');
            dayError.textContent = trans.dayError;
            isValid = false;
        }
        
        return isValid;
    }

    form.addEventListener('submit', (e) => {
        e.preventDefault();
        
        if (!validateInputs()) {
            return;
        }

        const resultsSection = document.getElementById('resultsSection');
        resultsSection.classList.remove('section-visible'); resultsSection.classList.add('section-hidden');
        const year = parseInt(document.getElementById('year').value);
        const month = parseInt(document.getElementById('month').value);
        const day = parseInt(document.getElementById('day').value);
        const hour = parseInt(document.getElementById('hour').value);
        
        const loader = document.getElementById('loader');
        loader.style.display = 'flex';
        document.getElementById('submitButton').disabled = true;
        setTimeout(() => {
            const analysisResult = sajuNamer.analyze(year, month, day, hour);
            const names = sajuNamer.generateNames(analysisResult, 2);
            displayResults(analysisResult, names, {year, month, day}, hour === -1);
            loader.style.display = 'none';
            document.getElementById('submitButton').disabled = false;
            resultsSection.classList.remove('section-hidden');
            resultsSection.classList.add('section-visible');
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 1500);
    });

    function displayResults(analysis, names, birthDate, isTimeUnknown) {
        const trans = translations[currentLang] || translations['en'];
        document.getElementById('birthDateDisplay').textContent = `${birthDate.year}-${String(birthDate.month).padStart(2,'0')}-${String(birthDate.day).padStart(2,'0')}`;
        
        const { analysisSummary } = sajuNamer.generateExplanation(analysis, names[0], currentLang);
        document.getElementById('sajuAnalysisReport').innerHTML = analysisSummary;

        const chartContainer = document.getElementById('fiveElementsChart');
        chartContainer.innerHTML = '';
        const counts = analysis.elementCounts;
        const elements = ['wood', 'fire', 'earth', 'metal', 'water'];
        const maxCount = Math.max(...Object.values(counts), 1);
        elements.forEach(el => {
            const count = counts[el];
            const height = (count / maxCount) * 100;
            const barColor = {wood: 'bg-green-500', fire: 'bg-red-500', earth: 'bg-yellow-500', metal: 'bg-gray-400', water: 'bg-blue-500'};
            const chartEl = `<div class="flex flex-col items-center justify-end h-full text-center"><div class="w-full text-sm font-semibold mb-1">${count}</div><div class="${barColor[el]} w-full rounded-t-md" style="height: ${height}%; min-height: 2px;"></div><div class="mt-2 text-xs md:text-sm font-medium text-gray-600">${trans.elements[el]}</div></div>`;
            chartContainer.innerHTML += chartEl;
        });

        const namesContainer = document.getElementById('recommendedNames');
        namesContainer.innerHTML = '';
        names.forEach((name, index) => {
            const { nameExplanation } = sajuNamer.generateExplanation(analysis, name, currentLang);
            const card = `
                <div class="p-5 bg-blue-50 border border-blue-200 rounded-lg">
                    <h4 class="text-lg font-semibold text-blue-800 mb-3">${trans.recommendation} #${index + 1}: ${name.roman} (${name.hangul} / <span class="hanja">${name.hanja}</span>)</h4>
                    <div class="text-gray-600 leading-relaxed space-y-2">${nameExplanation}</div>
                </div>`;
            namesContainer.innerHTML += card;
        });
        
        const timeInfo = document.getElementById('timeInfo');
        timeInfo.style.display = isTimeUnknown ? 'block' : 'none';
    }
    
    function setLanguage(lang) {
        document.documentElement.lang = lang; // Set HTML lang attribute
        const t = translations[lang] || translations['en'];
        currentLang = lang;
        document.querySelectorAll('[data-lang]').forEach(el => {
            const key = el.dataset.lang;
            if (t[key]) el.textContent = t[key];
        });
        selectedLangFlag.textContent = langMap[lang].flag;
        selectedLangText.textContent = langMap[lang].text;
        document.getElementById('hour').options[0].text = t.unknownTime;
    }
    
    // --- Modal Logic ---
    const privacyModal = document.getElementById('privacyModal');
    const termsModal = document.getElementById('termsModal');
    
    document.getElementById('privacyPolicyLink').addEventListener('click', (e) => {
        e.preventDefault();
        privacyModal.style.display = 'flex';
    });
    
    document.getElementById('termsOfServiceLink').addEventListener('click', (e) => {
        e.preventDefault();
        termsModal.style.display = 'flex';
    });

    document.getElementById('closePrivacyModal').addEventListener('click', () => {
        privacyModal.style.display = 'none';
    });

    document.getElementById('closeTermsModal').addEventListener('click', () => {
        termsModal.style.display = 'none';
    });

    window.addEventListener('click', (e) => {
        if (e.target === privacyModal) privacyModal.style.display = 'none';
        if (e.target === termsModal) termsModal.style.display = 'none';
    });

    initializeUI();
});
</script>
</body>
</html>
